{% extends "admin/base_site.html" %}
{% load i18n static jazzmin admin_stats %}
{% get_jazzmin_ui_tweaks as jazzmin_ui %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock %}

{% block content_title %}{% trans 'Dashboard' %}{% endblock %}

{% block breadcrumbs %}
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">{% trans 'Home' %}</a></li>
    <li class="breadcrumb-item">{% trans 'Dashboard' %}</li>
  </ol>
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
  <div class="col-lg-9 col-12">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="m-0">Doanh thu theo thời gian</h5>
            <small class="text-muted">Chỉ tính các thanh toán đã hoàn tất.</small>
          </div>
          <div class="card-body">
            <div class="mb-4">
              <h6>Doanh thu theo ngày (7 ngày)</h6>
              <canvas id="revenueDailyChart" height="140"></canvas>
            </div>
            <div class="mb-4">
              <h6>Doanh thu theo tuần (8 tuần)</h6>
              <canvas id="revenueWeeklyChart" height="140"></canvas>
            </div>
            <div>
              <h6>Doanh thu theo tháng (6 tháng)</h6>
              <canvas id="revenueMonthlyChart" height="140"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-12">
    <div id="content-related">
      <div class="module" id="recent-actions-module">
        <h4 class="mb-3">{% trans 'Recent actions' %}</h4>
        {% load log %}
        {% get_admin_log 6 as admin_log for_user user %}
        {% if not admin_log %}
          <p>{% trans 'None available' %}</p>
        {% else %}
          <div class="timeline">
            {% for entry in admin_log %}
              <div>
                {% if entry.is_change %}
                  <i class="fas fa-edit bg-gray text-xs"></i>
                {% elif entry.is_deletion %}
                  <i class="fas fa-trash bg-danger text-xs"></i>
                {% elif entry.is_addition %}
                  <i class="fas fa-plus-circle bg-success text-xs"></i>
                {% endif %}

                <div class="timeline-item">
                  <span class="time"><i class="fas fa-clock"></i> {% blocktrans with timesince=entry.action_time|timesince %}{{ timesince }} ago{% endblocktrans %}</span>
                  <h3 class="timeline-header no-border">
                    {% if entry.is_deletion or not entry.get_admin_url %}
                      {{ entry.object_repr }}
                    {% else %}
                      <a href="{{ entry.get_admin_url }}">{{ entry.object_repr }}</a>
                    {% endif %}

                    {% if entry.model %}
                      <span class="mini quiet">
                        {% filter capfirst %}
                          {{ entry.model }}
                        {% endfilter %}
                      </span>
                    {% endif %}
                  </h3>
                  {% if not entry.is_deletion %}
                    <div class="timeline-body">
                      {% if entry.is_addition %}
                        {{ entry }}
                      {% else %}
                        <ul style="list-style: none; padding: 0;">
                          {% action_message_to_list entry as action_message_list %}
                          {% for action_message in action_message_list %}
                            <li>{{ action_message.msg|style_bold_first_word }}</li>
                          {% endfor %}
                        </ul>
                      {% endif %}
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  {% revenue_chart_data as revenue_json %}
  <script id="revenue-data" type="application/json">{{ revenue_json|safe }}</script>
  <script src="{% static 'js/admin_dashboard.js' %}"></script>
{% endblock %}
