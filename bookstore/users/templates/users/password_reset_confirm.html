{% extends 'base.html' %}
{% block title %}Cập nhật mật khẩu{% endblock %}

{% block content %}
<div class="row justify-content-center my-5">
  <div class="col-md-6 col-lg-5">
    <div class="card shadow-sm rounded-4">
      <div class="card-body p-4 p-md-5">
        <!-- Title -->
        <h4 class="text-center mb-4 fw-bold text-uppercase">
          CẬP NHẬT MẬT KHẨU
        </h4>
        <form method="post">
          {% csrf_token %}
          <!-- New password -->
          <div class="mb-3">
            <label class="form-label fw-semibold">
              Mật khẩu mới <span class="text-danger">*</span>
            </label>
            {{ form.new_password1 }}
            <div id="password-rules" class="text-danger small mt-1"></div>
          </div>
          <!-- Confirm new password -->
          <div class="mb-4">
            <label class="form-label fw-semibold">
              Xác thực mật khẩu mới <span class="text-danger">*</span>
            </label>
            {{ form.new_password2 }}
            <div id="password-match" class="text-danger small mt-1"></div>
          </div>
          <!-- Submit -->
          <button type="submit"
                  class="btn btn-success w-100 py-2 fw-semibold"
                  style="background:#175229; border:none;">
            XÁC NHẬN
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const pwd1 = document.getElementById("id_new_password1");
  const pwd2 = document.getElementById("id_new_password2");

  const ruleBox = document.getElementById("password-rules");
  const matchBox = document.getElementById("password-match");

  pwd1.addEventListener("input", function () {
    const value = pwd1.value;
    let errors = [];

    if (value.length < 8) {
      errors.push("Mật khẩu phải có ít nhất 8 ký tự.");
    }
    if (/^\d+$/.test(value)) {
      errors.push("Mật khẩu không được chỉ bao gồm chữ số.");
    }
    if (["12345678", "password", "qwerty"].includes(value.toLowerCase())) {
      errors.push("Mật khẩu này quá phổ biến.");
    }

    ruleBox.innerHTML = errors.length
      ? errors.map(e => `<div>• ${e}</div>`).join("")
      : "";
  });

  pwd2.addEventListener("input", function () {
    if (pwd2.value && pwd1.value !== pwd2.value) {
      matchBox.innerHTML = "Mật khẩu xác nhận không khớp.";
    } else {
      matchBox.innerHTML = "";
    }
  });
});
</script>

{% endblock %}

