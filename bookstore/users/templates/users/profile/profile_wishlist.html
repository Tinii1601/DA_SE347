{% extends 'users/profile/profile_base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Sản phẩm yêu thích{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/wishlist.css' %}">
{% endblock %}

{% block profile_content %}
<div class="wishlist-page">
  <div class="section-heading">
    <h4>Sản phẩm yêu thích</h4>
    <p class="text-muted">Chỉ bạn thấy danh sách này trên tài khoản của mình.</p>
  </div>

  {% if wishlist_items %}
    <div class="wishlist-grid">
      {% for item in wishlist_items %}
        <div class="wishlist-card">
          <a href="{{ item.product.get_absolute_url }}" class="wishlist-thumb">
            {% if item.product.cover_image %}
              <img src="{{ item.product.cover_image.url }}" alt="{{ item.product.name }}">
            {% else %}
              <img src="{% static 'img/default-book-cover.jpg' %}" alt="{{ item.product.name }}">
            {% endif %}
          </a>
          <div class="wishlist-info">
            <a href="{{ item.product.get_absolute_url }}" class="wishlist-title">{{ item.product.name }}</a>
            <div class="wishlist-author">
              {% for attr_value in item.product.attribute_values.all %}
                {% if attr_value.attribute.name == "Tác giả" %}
                  {{ attr_value.value }}
                {% endif %}
              {% endfor %}
            </div>
            <div class="wishlist-price">{{ item.product.get_final_price|vnd_currency }}</div>
          </div>
          <form action="{% url 'users:wishlist_toggle' item.product.id %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button class="wishlist-heart" type="submit" aria-label="Bỏ yêu thích">
              <i class="bi bi-heart-fill"></i>
            </button>
          </form>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="wishlist-empty">
      <p>Bạn chưa có sản phẩm yêu thích nào.</p>
      <a href="{% url 'books:book_list' %}" class="btn btn-success btn-sm">Mua sắm ngay</a>
    </div>
  {% endif %}
</div>
{% endblock %}
