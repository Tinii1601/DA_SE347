<!-- books/templates/books/book_detail.html -->
{% extends 'base.html' %}
{% block title %}{{ book.title }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-5">
    {% if book.cover_image %}
      <img src="{{ book.cover_image.url }}" 
           class="img-fluid rounded shadow" 
           alt="{{ book.title }}" 
           loading="lazy">
    {% else %}
      <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 500px;">
        <span class="text-muted">Không có ảnh bìa</span>
      </div>
    {% endif %}
  </div>
  <div class="col-md-7">
    <h1>{{ book.title }}</h1>
    <p class="text-muted">Tác giả: <strong>{{ book.author }}</strong></p>
    <p>Nhà xuất bản: {{ book.publisher|default:"Không rõ" }}</p>
    <p>ISBN: {{ book.isbn|default:"N/A" }}</p>
    <hr>
    <p class="h4 text-danger fw-bold">{{ book.get_final_price|floatformat:0 }}₫</p>
    {% if book.discount_price %}
      <p class="text-decoration-line-through text-muted">Giá gốc: {{ book.price|floatformat:0 }}₫</p>
    {% endif %}
    <p><strong>Tồn kho:</strong> {{ book.stock }} cuốn</p>

    <div class="mt-3">
      <a href="#" class="btn btn-success btn-lg">Thêm vào giỏ hàng</a>
      <a href="{% url 'review_add' book.id %}" class="btn btn-outline-primary">Viết đánh giá</a>
    </div>

    <hr>
    <h5>Mô tả</h5>
    <p>{{ book.description|linebreaks }}</p>
  </div>
</div>

<hr>
<h5>Đánh giá từ khách hàng</h5>
{% for review in book.reviews.all %}
<div class="border p-3 mb-3 rounded">
  <p><strong>{{ review.user.get_full_name|default:review.user.username }}</strong> - {{ review.rating }} sao</p>
  <p>{{ review.comment }}</p>
  <small class="text-muted">{{ review.created_at|date:"d/m/Y" }}</small>
</div>
{% empty %}
<p class="text-muted">Chưa có đánh giá nào.</p>
{% endfor %}
{% endblock %}